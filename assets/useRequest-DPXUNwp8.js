import{bh as Y,r as b,bi as H,bj as p,bk as y,bl as oe,bm as P,bn as G,c as F,g as Z,bo as N,bp as se,bq as ce,br as fe,bs as ee,bt as le,bu as $}from"./index-XRI2Zuhs.js";const Hn=(e,n)=>Y.get(e,n),Gn=(e,n,r)=>Y.post(e,n,r);var ne=function(e,n){var r=n.manual,t=n.ready,i=t===void 0?!0:t,u=n.defaultParams,o=u===void 0?[]:u,c=n.refreshDeps,s=c===void 0?[]:c,f=n.refreshDepsAction,v=b.useRef(!1);return v.current=!1,H(function(){!r&&i&&(v.current=!0,e.run.apply(e,p([],y(o),!1)))},[i]),H(function(){v.current||r||(v.current=!0,f?f():e.refresh())},p([],y(s),!1)),{onBefore:function(){if(!i)return{stopNow:!0}}}};ne.onInit=function(e){var n=e.ready,r=n===void 0?!0:n,t=e.manual;return{loading:!t&&r}};function re(e,n){var r=b.useRef({deps:n,obj:void 0,initialized:!1}).current;return(r.initialized===!1||!oe(r.deps,n))&&(r.deps=n,r.obj=e(),r.initialized=!0),r.obj}var L=new Map,de=function(e,n,r){var t=L.get(e);t!=null&&t.timer&&clearTimeout(t.timer);var i=void 0;n>-1&&(i=setTimeout(function(){L.delete(e)},n)),L.set(e,P(P({},r),{timer:i}))},ve=function(e){return L.get(e)},D=new Map,me=function(e){return D.get(e)},ge=function(e,n){D.set(e,n),n.then(function(r){return D.delete(e),r}).catch(function(){D.delete(e)})},O={},be=function(e,n){O[e]&&O[e].forEach(function(r){return r(n)})},M=function(e,n){return O[e]||(O[e]=[]),O[e].push(n),function(){var t=O[e].indexOf(n);O[e].splice(t,1)}},he=function(e,n){var r=n.cacheKey,t=n.cacheTime,i=t===void 0?5*60*1e3:t,u=n.staleTime,o=u===void 0?0:u,c=n.setCache,s=n.getCache,f=b.useRef(),v=b.useRef(),a=function(l,d){c?c(d):de(l,i,d),be(l,d.data)},g=function(l,d){return d===void 0&&(d=[]),s?s(d):ve(l)};return re(function(){if(r){var l=g(r);l&&Object.hasOwnProperty.call(l,"data")&&(e.state.data=l.data,e.state.params=l.params,(o===-1||new Date().getTime()-l.time<=o)&&(e.state.loading=!1)),f.current=M(r,function(d){e.setState({data:d})})}},[]),G(function(){var l;(l=f.current)===null||l===void 0||l.call(f)}),r?{onBefore:function(l){var d=g(r,l);return!d||!Object.hasOwnProperty.call(d,"data")?{}:o===-1||new Date().getTime()-d.time<=o?{loading:!1,data:d==null?void 0:d.data,error:void 0,returnNow:!0}:{data:d==null?void 0:d.data,error:void 0}},onRequest:function(l,d){var h=me(r);return h&&h!==v.current?{servicePromise:h}:(h=l.apply(void 0,p([],y(d),!1)),v.current=h,ge(r,h),{servicePromise:h})},onSuccess:function(l,d){var h;r&&((h=f.current)===null||h===void 0||h.call(f),a(r,{data:l,params:d,time:new Date().getTime()}),f.current=M(r,function(j){e.setState({data:j})}))},onMutate:function(l){var d;r&&((d=f.current)===null||d===void 0||d.call(f),a(r,{data:l,params:e.state.params,time:new Date().getTime()}),f.current=M(r,function(h){e.setState({data:h})}))}}:{}};function pe(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}var I=pe,ye=typeof F=="object"&&F&&F.Object===Object&&F,Te=ye,Se=Te,Re=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Se||Re||Function("return this")(),te=Pe,we=te,je=function(){return we.Date.now()},Oe=je,Ee=/\s/;function $e(e){for(var n=e.length;n--&&Ee.test(e.charAt(n)););return n}var Ce=$e,_e=Ce,xe=/^\s+/;function Ae(e){return e&&e.slice(0,_e(e)+1).replace(xe,"")}var We=Ae,Fe=te,Le=Fe.Symbol,ie=Le,z=ie,ae=Object.prototype,De=ae.hasOwnProperty,Ne=ae.toString,x=z?z.toStringTag:void 0;function Me(e){var n=De.call(e,x),r=e[x];try{e[x]=void 0;var t=!0}catch{}var i=Ne.call(e);return t&&(n?e[x]=r:delete e[x]),i}var Be=Me,He=Object.prototype,Ge=He.toString;function Ie(e){return Ge.call(e)}var Ue=Ie,X=ie,ke=Be,ze=Ue,Xe="[object Null]",qe="[object Undefined]",q=X?X.toStringTag:void 0;function Ve(e){return e==null?e===void 0?qe:Xe:q&&q in Object(e)?ke(e):ze(e)}var Je=Ve;function Ke(e){return e!=null&&typeof e=="object"}var Qe=Ke,Ye=Je,Ze=Qe,en="[object Symbol]";function nn(e){return typeof e=="symbol"||Ze(e)&&Ye(e)==en}var rn=nn,tn=We,V=I,an=rn,J=NaN,un=/^[-+]0x[0-9a-f]+$/i,on=/^0b[01]+$/i,sn=/^0o[0-7]+$/i,cn=parseInt;function fn(e){if(typeof e=="number")return e;if(an(e))return J;if(V(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=V(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=tn(e);var r=on.test(e);return r||sn.test(e)?cn(e.slice(2),r?2:8):un.test(e)?J:+e}var ln=fn,dn=I,B=Oe,K=ln,vn="Expected a function",mn=Math.max,gn=Math.min;function bn(e,n,r){var t,i,u,o,c,s,f=0,v=!1,a=!1,g=!0;if(typeof e!="function")throw new TypeError(vn);n=K(n)||0,dn(r)&&(v=!!r.leading,a="maxWait"in r,u=a?mn(K(r.maxWait)||0,n):u,g="trailing"in r?!!r.trailing:g);function l(m){var S=t,R=i;return t=i=void 0,f=m,o=e.apply(R,S),o}function d(m){return f=m,c=setTimeout(w,n),v?l(m):o}function h(m){var S=m-s,R=m-f,k=n-S;return a?gn(k,u-R):k}function j(m){var S=m-s,R=m-f;return s===void 0||S>=n||S<0||a&&R>=u}function w(){var m=B();if(j(m))return C(m);c=setTimeout(w,h(m))}function C(m){return c=void 0,g&&t?l(m):(t=i=void 0,o)}function _(){c!==void 0&&clearTimeout(c),f=0,t=s=i=c=void 0}function E(){return c===void 0?o:C(B())}function T(){var m=B(),S=j(m);if(t=arguments,i=this,s=m,S){if(c===void 0)return d(s);if(a)return clearTimeout(c),c=setTimeout(w,n),l(s)}return c===void 0&&(c=setTimeout(w,n)),o}return T.cancel=_,T.flush=E,T}var ue=bn;const hn=Z(ue);var pn=function(e,n){var r=n.debounceWait,t=n.debounceLeading,i=n.debounceTrailing,u=n.debounceMaxWait,o=b.useRef(),c=b.useMemo(function(){var s={};return t!==void 0&&(s.leading=t),i!==void 0&&(s.trailing=i),u!==void 0&&(s.maxWait=u),s},[t,i,u]);return b.useEffect(function(){if(r){var s=e.runAsync.bind(e);return o.current=hn(function(f){f()},r,c),e.runAsync=function(){for(var f=[],v=0;v<arguments.length;v++)f[v]=arguments[v];return new Promise(function(a,g){var l;(l=o.current)===null||l===void 0||l.call(o,function(){s.apply(void 0,p([],y(f),!1)).then(a).catch(g)})})},function(){var f;(f=o.current)===null||f===void 0||f.cancel(),e.runAsync=s}}},[r,c]),r?{onCancel:function(){var s;(s=o.current)===null||s===void 0||s.cancel()}}:{}},yn=function(e,n){var r=n.loadingDelay,t=n.ready,i=b.useRef();if(!r)return{};var u=function(){i.current&&clearTimeout(i.current)};return{onBefore:function(){return u(),t!==!1&&(i.current=setTimeout(function(){e.setState({loading:!0})},r)),{loading:!1}},onFinally:function(){u()},onCancel:function(){u()}}};function U(){return N?document.visibilityState!=="hidden":!0}var A=[];function Tn(e){return A.push(e),function(){var r=A.indexOf(e);A.splice(r,1)}}if(N){var Sn=function(){if(U())for(var e=0;e<A.length;e++){var n=A[e];n()}};window.addEventListener("visibilitychange",Sn,!1)}var Rn=function(e,n){var r=n.pollingInterval,t=n.pollingWhenHidden,i=t===void 0?!0:t,u=n.pollingErrorRetryCount,o=u===void 0?-1:u,c=b.useRef(),s=b.useRef(),f=b.useRef(0),v=function(){var a;c.current&&clearTimeout(c.current),(a=s.current)===null||a===void 0||a.call(s)};return H(function(){r||v()},[r]),r?{onBefore:function(){v()},onError:function(){f.current+=1},onSuccess:function(){f.current=0},onFinally:function(){o===-1||o!==-1&&f.current<=o?c.current=setTimeout(function(){!i&&!U()?s.current=Tn(function(){e.refresh()}):e.refresh()},r):f.current=0},onCancel:function(){v()}}:{}};function Pn(e,n){var r=!1;return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];r||(r=!0,e.apply(void 0,p([],y(t),!1)),setTimeout(function(){r=!1},n))}}function wn(){return N&&typeof navigator.onLine<"u"?navigator.onLine:!0}var W=[];function jn(e){return W.push(e),function(){var r=W.indexOf(e);r>-1&&W.splice(r,1)}}if(N){var Q=function(){if(!(!U()||!wn()))for(var e=0;e<W.length;e++){var n=W[e];n()}};window.addEventListener("visibilitychange",Q,!1),window.addEventListener("focus",Q,!1)}var On=function(e,n){var r=n.refreshOnWindowFocus,t=n.focusTimespan,i=t===void 0?5e3:t,u=b.useRef(),o=function(){var c;(c=u.current)===null||c===void 0||c.call(u)};return b.useEffect(function(){if(r){var c=Pn(e.refresh.bind(e),i);u.current=jn(function(){c()})}return function(){o()}},[r,i]),G(function(){o()}),{}},En=function(e,n){var r=n.retryInterval,t=n.retryCount,i=b.useRef(),u=b.useRef(0),o=b.useRef(!1);return t?{onBefore:function(){o.current||(u.current=0),o.current=!1,i.current&&clearTimeout(i.current)},onSuccess:function(){u.current=0},onError:function(){if(u.current+=1,t===-1||u.current<=t){var c=r??Math.min(1e3*Math.pow(2,u.current),3e4);i.current=setTimeout(function(){o.current=!0,e.refresh()},c)}else u.current=0},onCancel:function(){u.current=0,i.current&&clearTimeout(i.current)}}:{}},$n=ue,Cn=I,_n="Expected a function";function xn(e,n,r){var t=!0,i=!0;if(typeof e!="function")throw new TypeError(_n);return Cn(r)&&(t="leading"in r?!!r.leading:t,i="trailing"in r?!!r.trailing:i),$n(e,n,{leading:t,maxWait:n,trailing:i})}var An=xn;const Wn=Z(An);var Fn=function(e,n){var r=n.throttleWait,t=n.throttleLeading,i=n.throttleTrailing,u=b.useRef(),o={};return t!==void 0&&(o.leading=t),i!==void 0&&(o.trailing=i),b.useEffect(function(){if(r){var c=e.runAsync.bind(e);return u.current=Wn(function(s){s()},r,o),e.runAsync=function(){for(var s=[],f=0;f<arguments.length;f++)s[f]=arguments[f];return new Promise(function(v,a){var g;(g=u.current)===null||g===void 0||g.call(u,function(){c.apply(void 0,p([],y(s),!1)).then(v).catch(a)})})},function(){var s;e.runAsync=c,(s=u.current)===null||s===void 0||s.cancel()}}},[r,t,i]),r?{onCancel:function(){var c;(c=u.current)===null||c===void 0||c.cancel()}}:{}},Ln=function(e){b.useEffect(function(){e==null||e()},[])},Dn=function(){var e=y(b.useState({}),2),n=e[1];return b.useCallback(function(){return n({})},[])},Nn=function(){function e(n,r,t,i){i===void 0&&(i={}),this.serviceRef=n,this.options=r,this.subscribe=t,this.initState=i,this.count=0,this.state={loading:!1,params:void 0,data:void 0,error:void 0},this.state=P(P(P({},this.state),{loading:!r.manual}),i)}return e.prototype.setState=function(n){n===void 0&&(n={}),this.state=P(P({},this.state),n),this.subscribe()},e.prototype.runPluginHandler=function(n){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var i=this.pluginImpls.map(function(u){var o;return(o=u[n])===null||o===void 0?void 0:o.call.apply(o,p([u],y(r),!1))}).filter(Boolean);return Object.assign.apply(Object,p([{}],y(i),!1))},e.prototype.runAsync=function(){for(var n,r,t,i,u,o,c,s,f,v,a=[],g=0;g<arguments.length;g++)a[g]=arguments[g];return se(this,void 0,void 0,function(){var l,d,h,j,w,C,_,E,T,m,S;return fe(this,function(R){switch(R.label){case 0:if(this.count+=1,l=this.count,d=this.runPluginHandler("onBefore",a),h=d.stopNow,j=h===void 0?!1:h,w=d.returnNow,C=w===void 0?!1:w,_=ee(d,["stopNow","returnNow"]),j)return[2,new Promise(function(){})];if(this.setState(P({loading:!0,params:a},_)),C)return[2,Promise.resolve(_.data)];(r=(n=this.options).onBefore)===null||r===void 0||r.call(n,a),R.label=1;case 1:return R.trys.push([1,3,,4]),E=this.runPluginHandler("onRequest",this.serviceRef.current,a).servicePromise,E||(E=(S=this.serviceRef).current.apply(S,p([],y(a),!1))),[4,E];case 2:return T=R.sent(),l!==this.count?[2,new Promise(function(){})]:(this.setState({data:T,error:void 0,loading:!1}),(i=(t=this.options).onSuccess)===null||i===void 0||i.call(t,T,a),this.runPluginHandler("onSuccess",T,a),(o=(u=this.options).onFinally)===null||o===void 0||o.call(u,a,T,void 0),l===this.count&&this.runPluginHandler("onFinally",a,T,void 0),[2,T]);case 3:if(m=R.sent(),l!==this.count)return[2,new Promise(function(){})];throw this.setState({error:m,loading:!1}),(s=(c=this.options).onError)===null||s===void 0||s.call(c,m,a),this.runPluginHandler("onError",m,a),(v=(f=this.options).onFinally)===null||v===void 0||v.call(f,a,void 0,m),l===this.count&&this.runPluginHandler("onFinally",a,void 0,m),m;case 4:return[2]}})})},e.prototype.run=function(){for(var n=this,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];this.runAsync.apply(this,p([],y(r),!1)).catch(function(i){n.options.onError||console.error(i)})},e.prototype.cancel=function(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")},e.prototype.refresh=function(){this.run.apply(this,p([],y(this.state.params||[]),!1))},e.prototype.refreshAsync=function(){return this.runAsync.apply(this,p([],y(this.state.params||[]),!1))},e.prototype.mutate=function(n){var r=ce(n)?n(this.state.data):n;this.runPluginHandler("onMutate",r),this.setState({data:r})},e}();function Mn(e,n,r){n===void 0&&(n={}),r===void 0&&(r=[]);var t=n.manual,i=t===void 0?!1:t,u=n.ready,o=u===void 0?!0:u,c=ee(n,["manual","ready"]),s=P({manual:i,ready:o},c),f=le(e),v=Dn(),a=re(function(){var g=r.map(function(l){var d;return(d=l==null?void 0:l.onInit)===null||d===void 0?void 0:d.call(l,s)}).filter(Boolean);return new Nn(f,s,v,Object.assign.apply(Object,p([{}],y(g),!1)))},[]);return a.options=s,a.pluginImpls=r.map(function(g){return g(a,s)}),Ln(function(){if(!i&&o){var g=a.state.params||n.defaultParams||[];a.run.apply(a,p([],y(g),!1))}}),G(function(){a.cancel()}),{loading:a.state.loading,data:a.state.data,error:a.state.error,params:a.state.params||[],cancel:$(a.cancel.bind(a)),refresh:$(a.refresh.bind(a)),refreshAsync:$(a.refreshAsync.bind(a)),run:$(a.run.bind(a)),runAsync:$(a.runAsync.bind(a)),mutate:$(a.mutate.bind(a))}}function In(e,n,r){return Mn(e,n,p(p([],y([]),!1),[pn,yn,Rn,On,Fn,ne,he,En],!1))}export{Hn as G,Gn as P,Ln as a,In as u};
